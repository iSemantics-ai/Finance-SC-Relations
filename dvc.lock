schema: '2.0'
stages:
  load_data:
    cmd: python src/stages/load_data.py --config params.yaml
    deps:
    - path: src/stages/load_data.py
      hash: md5
      md5: 7c9a3215e0c56c9d6829ee38b6272578
      size: 3278
    params:
      params.yaml:
        base.nlp: en_core_web_trf
        load_data:
          dataset: data/raw/llm_aligned_0_1_huge_complex.json
          entity_1: entity_1
          entity_2: entity_2
          output_dir: data/raw/relations_training_data.json
          target: relation
          text_col: sentence
    outs:
    - path: data/raw/relations_training_data.json
      hash: md5
      md5: 34a13f21603a9294d5b4e1cc563f15a4
      size: 19426710
  data_split:
    cmd: python src/stages/data_split.py --config params.yaml
    deps:
    - path: data/raw/relations_training_data.json
      hash: md5
      md5: 34a13f21603a9294d5b4e1cc563f15a4
      size: 19426710
    - path: src/stages/data_split.py
      hash: md5
      md5: eaaee750b9a1ab93832bc51b998dabe6
      size: 4283
    - path: src/utils/preprocess.py
      hash: md5
      md5: 1142f4f0b37285f34cf25100d94100bb
      size: 18518
    params:
      params.yaml:
        base:
          basic_columns:
          - Label
          - concept_class
          - idx
          - org_groups
          - spans
          entity_static_position: false
          index_col: idx
          log_level: INFO
          main_relations:
          - supplier
          - customer
          nlp: en_core_web_trf
          random_state: 42
        data_split:
          drop_issues: false
          issues_name: LLM_ALL_ALIGNED_COMPLEX
          issues_pruning: 0.3
          neg_supply: true
          num_positions: 0
          output_dir: data/train/
          random_choice: true
          stratify_by:
          - concept_class
          - Label
          val_size: 0.2
        load_data.output_dir: data/raw/relations_training_data.json
    outs:
    - path: data/train/distributions.md
      hash: md5
      md5: ac268642edc40f302e5e05bc87a50473
      size: 1649
    - path: data/train/train.json
      hash: md5
      md5: 912ecfd64c219775e4dc22ec59f5c8e8
      size: 19029316
    - path: data/train/valid.json
      hash: md5
      md5: 29eefcd06165d02995d8e68a87bc025d
      size: 4968687
  train_preprocess:
    cmd: python src/stages/train_preprocess.py --config params.yaml
    deps:
    - path: data/train/train.json
      hash: md5
      md5: 912ecfd64c219775e4dc22ec59f5c8e8
      size: 19029316
    - path: data/train/valid.json
      hash: md5
      md5: 29eefcd06165d02995d8e68a87bc025d
      size: 4968687
    - path: src/stages/train_preprocess.py
      hash: md5
      md5: 86a415c2f40e908f60fa29231e0b0b35
      size: 1335
    params:
      params.yaml:
        base:
          basic_columns:
          - Label
          - concept_class
          - idx
          - org_groups
          - spans
          entity_static_position: false
          index_col: idx
          log_level: INFO
          main_relations:
          - supplier
          - customer
          nlp: en_core_web_trf
          random_state: 42
        train_preprocess:
          inverse: true
          output_dir: data/train/
          relations_mapper: data/train/relations.pkl
          stage: train
    outs:
    - path: data/train/df_train.json
      hash: md5
      md5: 9b43a394af6f885ca4bb6a64ee157eb4
      size: 27418011
    - path: data/train/df_valid.json
      hash: md5
      md5: 906376148ad914a9bba4a76748f3f796
      size: 7030365
    - path: data/train/relations.pkl
      hash: md5
      md5: ac311efcf39ee9e7d07310b7f1cd520e
      size: 177
  train:
    cmd: python src/stages/train.py --config params.yaml
    deps:
    - path: data/train/df_train.json
      hash: md5
      md5: 9b43a394af6f885ca4bb6a64ee157eb4
      size: 27418011
    - path: data/train/df_valid.json
      hash: md5
      md5: 906376148ad914a9bba4a76748f3f796
      size: 7030365
    - path: data/train/relations.pkl
      hash: md5
      md5: ac311efcf39ee9e7d07310b7f1cd520e
      size: 177
    - path: src/relation_extraction/trainer.py
      hash: md5
      md5: 3b49aae8568cd0397a27a66c730907c7
      size: 11528
    - path: src/stages/train.py
      hash: md5
      md5: 973a6740e8d13031f05f7691c2fc23c1
      size: 962
    params:
      params.yaml:
        base:
          basic_columns:
          - Label
          - concept_class
          - idx
          - org_groups
          - spans
          entity_static_position: false
          index_col: idx
          log_level: INFO
          main_relations:
          - supplier
          - customer
          nlp: en_core_web_trf
          random_state: 42
        train:
          batch_size: 40
          fp16: 1
          freeze: 0
          gradient_acc_steps: 1
          lr: 2e-05
          max_norm: 1
          model_path: artifacts/re_model
          model_size: nlpaueb/sec-bert-num
          mutate_test: true
          mutate_train: true
          num_epochs: 2
          overwrite: false
          relations_mapper: data/train/relations.pkl
          reload: false
          train_data: data/train/df_train.json
          update_ext: false
          use_pretrained_blanks: 0
          valid_data: data/train/df_valid.json
          weight_decay: 0.0001
          weight_loss: false
    outs:
    - path: artifacts/re_model
      hash: md5
      md5: a45b0938e3d74943ebd958ac4833eedd.dir
      size: 437372729
      nfiles: 8
    - path: metrics/customer_f1_score.csv
      hash: md5
      md5: 864fd35780d71d6fd463ad8e085fa6b8
      size: 42
    - path: metrics/other_f1_score.csv
      hash: md5
      md5: 4cfe745f07ce1301d87f0b4983bee0ad
      size: 39
    - path: metrics/supplier_f1_score.csv
      hash: md5
      md5: 6da08c3e3291fd5fc5b11bffa2e5df45
      size: 42
    - path: metrics/train_accuracy.csv
      hash: md5
      md5: 2ec9d0b1780ad9cdfdde0c7aa34dd216
      size: 63
    - path: metrics/train_losses.csv
      hash: md5
      md5: ae7aba37b5448dac2426544865a40585
      size: 63
    - path: metrics/valid_accuracy.csv
      hash: md5
      md5: 9ac946f0ad6cd7c94a537f90fcd6993c
      size: 39
    - path: metrics/valid_f1_macro.csv
      hash: md5
      md5: 46cc1fc8fd0e0feff2e586600c5f4b56
      size: 39
    - path: metrics/valid_precision.csv
      hash: md5
      md5: 57020dc95c35999142b5f66c48fe5e83
      size: 40
    - path: metrics/valid_recall.csv
      hash: md5
      md5: 2565a22fc26383fd969f67a55da156f8
      size: 37
    - path: metrics/valid_roc_auc.png
      hash: md5
      md5: f4a73bb7cccedfe09e8e644db2332ece
      size: 63214
  evaluate:
    cmd: python src/stages/evaluate.py --config params.yaml
    deps:
    - path: artifacts/re_model
      hash: md5
      md5: a45b0938e3d74943ebd958ac4833eedd.dir
      size: 437372729
      nfiles: 8
    - path: src/relation_extraction/infer.py
      hash: md5
      md5: 27bff04f84d89cd41d25505eb979fb30
      size: 21308
    - path: src/stages/evaluate.py
      hash: md5
      md5: c630eaaa50efc1e2b7f9f88a7e3133d9
      size: 9227
    params:
      params.yaml:
        base:
          basic_columns:
          - Label
          - concept_class
          - idx
          - org_groups
          - spans
          entity_static_position: false
          index_col: idx
          log_level: INFO
          main_relations:
          - supplier
          - customer
          nlp: en_core_web_trf
          random_state: 42
        train:
          batch_size: 40
          fp16: 1
          freeze: 0
          gradient_acc_steps: 1
          lr: 2e-05
          max_norm: 1
          model_path: artifacts/re_model
          model_size: nlpaueb/sec-bert-num
          mutate_test: true
          mutate_train: true
          num_epochs: 2
          overwrite: false
          relations_mapper: data/train/relations.pkl
          reload: false
          train_data: data/train/df_train.json
          update_ext: false
          use_pretrained_blanks: 0
          valid_data: data/train/df_valid.json
          weight_decay: 0.0001
          weight_loss: false
    outs:
    - path: metrics/dev_classification_report.md
      hash: md5
      md5: ef70b58ff2f164484fd2b5a7122b4b51
      size: 599
    - path: metrics/dev_confusion.png
      hash: md5
      md5: ab9362968382ea0c9c3b935fac5add22
      size: 23210
    - path: metrics/dev_errors.xlsx
      hash: md5
      md5: 23d7094d88ddd46eb876a057d46767af
      size: 135064
    - path: metrics/dev_inconsistent_directions.xlsx
      hash: md5
      md5: f06991ef37a1ebc50ebdea5d91b90d4e
      size: 33224
    - path: metrics/dev_metrics.json
      hash: md5
      md5: ac1a41b2e628e3d1fe3083421ee66078
      size: 114
    - path: metrics/test_classification_report.md
      hash: md5
      md5: da40d984947edb8594d8e5efe2480575
      size: 581
    - path: metrics/test_confusion.png
      hash: md5
      md5: 9b983d7f7343536786daa962c824e0e6
      size: 26082
    - path: metrics/test_errors.xlsx
      hash: md5
      md5: ddb393a06553f06ddaa1dfe553ece95d
      size: 36999
    - path: metrics/test_inconsistent_directions.xlsx
      hash: md5
      md5: 43074f87f89fd378516de618f524d962
      size: 13218
    - path: metrics/test_metrics.json
      hash: md5
      md5: a0b48d76d351e93dcd5594997c3ebd24
      size: 118
  train_sc:
    cmd: python src/stages/sc_train.py
    deps:
    - path: data/train/train.json
      hash: md5
      md5: 912ecfd64c219775e4dc22ec59f5c8e8
      size: 19029316
    - path: data/train/valid.json
      hash: md5
      md5: 29eefcd06165d02995d8e68a87bc025d
      size: 4968687
    - path: src/sc_classifier/trainer.py
      hash: md5
      md5: 73baac91ab629abc6de60c2fad0524a6
      size: 28071
    - path: src/stages/sc_train.py
      hash: md5
      md5: 0492495176f942f33cf4a453ebaa7074
      size: 491
    params:
      params.yaml:
        base:
          basic_columns:
          - Label
          - concept_class
          - idx
          - org_groups
          - spans
          entity_static_position: false
          index_col: idx
          log_level: INFO
          main_relations:
          - supplier
          - customer
          nlp: en_core_web_trf
          random_state: 42
        sc_train:
          base_model: nlpaueb/sec-bert-base
          batch_size: 45
          classes:
          - 0
          - 1
          clip: false
          cuda: '0'
          dev_test_split: false
          epochs: 4
          features:
          - orig_sents
          learning_rate: 5e-05
          load_pretrained: false
          mutate: true
          num_workers: 0
          package_name: SupplyChainClassifier
          pipeline_name: supplychain_classification_model
          pipeline_save_file: supplychain_classification_model_output
          seed: 1
          target: Label
          train_file: data/train/train.json
          truncate: 512
          valid_file: data/train/valid.json
          wandb: false
          warmup_smooth: 0.8
          weight_decay: 0.001
    outs:
    - path: artifacts/sc_model
      hash: md5
      md5: 7fc56b13f8b182676e6cc4151ab57610.dir
      size: 437331019
      nfiles: 9
    - path: sc_metrics/sc_train_f1.csv
      hash: md5
      md5: e8e4ed4a42323ab659fffaeb878836bf
      size: 107
    - path: sc_metrics/sc_train_loss.csv
      hash: md5
      md5: 7c0c6fba80510b8916375123d82bd5fa
      size: 113
    - path: sc_metrics/sc_val_f1.csv
      hash: md5
      md5: 23b899459614b87b85111f2a3b0817d5
      size: 105
    - path: sc_metrics/sc_valid_metrics.json
      hash: md5
      md5: 5a526a0d6042feacd141215775b89e0d
      size: 164
